<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KasiFix – Find Trusted Local Help in Your Kasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .hero-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px -10px rgba(249, 115, 22, 0.25);
        }

        .pill-btn {
            border-radius: 9999px;
            transition: all 0.3s ease;
        }
        .pill-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.2);
        }

        /* Search Bar Animation */
        .search-container {
            position: relative;
            overflow: hidden;
            max-width: 1100px;
            margin: 0 auto;
        }
        .search-input {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        .search-input:focus {
            transform: scale(1.02);
            box-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.2);
            border-color: #f97316;
        }
        .search-input::placeholder {
            transition: all 0.3s ease;
        }
        .search-input:focus::placeholder {
            color: #f97316;
        }
        .search-glow {
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, #f97316, #fb923c, #f97316);
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .search-input:focus ~ .search-glow {
            opacity: 1;
        }

        .advanced-panel {
            transition: all 0.4s ease;
            max-height: 0;
            overflow: hidden;
        }
        .advanced-panel.open {
            max-height: 500px;
        }

        /* Modal Styles */
        .modal {
            transition: all 0.3s ease;
        }
        .modal-content {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Navigation -->
    <nav class="bg-white border-b sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center cursor-pointer" onclick="window.location.href='index.html'">
                    <span class="text-2xl font-extrabold text-[#1e3a8a]">Kasi<span class="text-[#f97316]">Fix</span></span>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#how-it-works" class="text-gray-700 hover:text-[#1e3a8a] font-medium">How it Works</a>
                    <a href="#categories" class="text-gray-700 hover:text-[#1e3a8a] font-medium">Categories</a>
                    <a href="#featured" class="text-gray-700 hover:text-[#1e3a8a] font-medium">Find Help</a>
                    <a href="hustler-signup.html" class="pill-btn bg-[#f97316] text-white px-6 py-2.5 font-bold hover:bg-orange-600 transition shadow">
                        Become a Hustler
                    </a>
                    <button onclick="openFeaturedModal()" class="pill-btn bg-blue-600 text-white px-6 py-2.5 font-bold hover:bg-blue-700 transition shadow">
                        Apply to be Featured
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero with Advanced Search -->
    <section class="hero-bg text-white py-24 md:py-32">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-6 leading-tight">
                Find Trusted Local Help<br/>Right in Your Kasi
            </h1>
            <p class="text-xl md:text-2xl text-blue-100 mb-10 max-w-3xl mx-auto">
                From plumbers and electricians to car washers and errand runners — real people, real skills, real fast.
            </p>

            <!-- Search Container -->
            <div class="search-container bg-white p-4 md:p-5 rounded-3xl shadow-2xl transform transition hover:scale-[1.01]">
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- Keyword -->
                    <div class="flex-1 relative">
                        <input 
                            type="text" 
                            id="search-keyword" 
                            placeholder="Plumber, barber, solar installation..." 
                            class="search-input w-full px-5 py-4 pl-12 rounded-2xl text-lg outline-none"
                            oninput="filterFeatured()"
                        >
                        <i class="fa-solid fa-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
                        <div class="search-glow"></div>
                    </div>

                    <!-- Location -->
                    <div class="md:w-64 relative">
                        <input 
                            type="text" 
                            id="search-location" 
                            placeholder="Your location (e.g. Soweto)" 
                            class="search-input w-full px-5 py-4 pl-12 rounded-2xl text-lg outline-none"
                            value="Johannesburg"
                            oninput="filterFeatured()"
                        >
                        <i class="fa-solid fa-location-dot absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
                        <div class="search-glow"></div>
                    </div>

                    <!-- Advanced Toggle -->
                    <button 
                        onclick="toggleAdvanced()"
                        class="pill-btn bg-gray-100 text-gray-700 px-6 py-4 rounded-2xl font-medium hover:bg-gray-200 transition flex items-center justify-center md:w-48"
                    >
                        <i class="fa-solid fa-sliders mr-2"></i> Advanced
                    </button>
                </div>

                <!-- Advanced Filters Panel -->
                <div id="advanced-panel" class="advanced-panel mt-5 px-2">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                            <select id="search-category" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-[#f97316] outline-none bg-white" onchange="filterFeatured()">
                                <option value="">All Categories</option>
                            </select>
                        </div>

                        <!-- Min Rate -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Min Hourly Rate (R)</label>
                            <input type="number" id="search-min-rate" min="0" placeholder="e.g. 150" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-[#f97316] outline-none" oninput="filterFeatured()">
                        </div>

                        <!-- Verified Only -->
                        <div class="flex items-end">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="search-verified-only" class="w-5 h-5 text-[#f97316] border-gray-300 rounded focus:ring-[#f97316]" onchange="filterFeatured()" checked>
                                <span class="ml-3 text-gray-700 font-medium">Verified hustlers only</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-center gap-5 mt-10 max-w-xl mx-auto">
                <a href="#featured" class="pill-btn bg-white text-[#1e3a8a] px-10 py-5 text-lg font-bold hover:bg-gray-100 transition shadow-lg">
                    Browse All Hustlers
                </a>
                <a href="hustler-signup.html" class="pill-btn border-2 border-white text-white px-10 py-5 text-lg font-bold hover:bg-white hover:text-[#1e3a8a] transition">
                    Join as a Hustler
                </a>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-12 text-gray-900">How It Works</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center p-6 card-hover bg-gray-50 rounded-2xl shadow-md">
                    <i class="fa-solid fa-search text-5xl text-[#f97316] mb-6"></i>
                    <h3 class="font-bold text-xl mb-4">Search for Help</h3>
                    <p class="text-gray-600">Use our advanced search to find trusted local hustlers in your kasi.</p>
                </div>
                <div class="text-center p-6 card-hover bg-gray-50 rounded-2xl shadow-md">
                    <i class="fa-solid fa-user-check text-5xl text-[#f97316] mb-6"></i>
                    <h3 class="font-bold text-xl mb-4">Connect Instantly</h3>
                    <p class="text-gray-600">Chat directly with hustlers via WhatsApp for quick arrangements.</p>
                </div>
                <div class="text-center p-6 card-hover bg-gray-50 rounded-2xl shadow-md">
                    <i class="fa-solid fa-tools text-5xl text-[#f97316] mb-6"></i>
                    <h3 class="font-bold text-xl mb-4">Get It Done</h3>
                    <p class="text-gray-600">Enjoy reliable, fast service from verified local professionals.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section id="categories" class="py-20 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-12 text-gray-900">Popular Categories</h2>
            <div id="categories-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Categories will be dynamically rendered here -->
            </div>
        </div>
    </section>

    <!-- Featured Hustlers Section -->
    <section id="featured-hustlers" class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-12 text-gray-900">Featured Hustlers</h2>
            <div id="featured-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Featured hustler cards will be rendered here -->
            </div>
        </div>
    </section>

    <!-- All Hustlers (Find Help) Section -->
    <section id="featured" class="py-20 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-12 text-gray-900">Find Hustlers</h2>
            <div id="hustlers-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- All hustler cards will be rendered here based on filters -->
            </div>
        </div>
    </section>

    <!-- Professional Footer -->
    <footer class="bg-[#1e3a8a] text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">KasiFix</h3>
                    <p class="text-blue-100">Connecting local talent with community needs in your kasi. Trusted, fast, and reliable services at your fingertips.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#how-it-works" class="hover:text-[#f97316] transition">How it Works</a></li>
                        <li><a href="#categories" class="hover:text-[#f97316] transition">Categories</a></li>
                        <li><a href="#featured" class="hover:text-[#f97316] transition">Find Help</a></li>
                        <li><a href="hustler-signup.html" class="hover:text-[#f97316] transition">Become a Hustler</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Support</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="hover:text-[#f97316] transition">FAQ</a></li>
                        <li><a href="#" class="hover:text-[#f97316] transition">Contact Us</a></li>
                        <li><a href="#" class="hover:text-[#f97316] transition">Privacy Policy</a></li>
                        <li><a href="#" class="hover:text-[#f97316] transition">Terms of Service</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-2xl hover:text-[#f97316] transition"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-2xl hover:text-[#f97316] transition"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-2xl hover:text-[#f97316] transition"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-2xl hover:text-[#f97316] transition"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-blue-800 text-center text-blue-200">
                &copy; 2026 KasiFix. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Featured Application Modal -->
    <div id="featured-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="modal-content bg-white rounded-2xl p-8 max-w-md w-full m-4">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold mb-6 text-center">Apply to be Featured</h2>
            <form id="featured-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">Your Name</label>
                    <input type="text" name="name" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-[#f97316] outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">Phone Number</label>
                    <input type="tel" name="phone" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-[#f97316] outline-none">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-700">Why should you be featured?</label>
                    <textarea name="reason" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-[#f97316] outline-none" rows="4"></textarea>
                </div>
                <button type="submit" class="w-full bg-[#f97316] text-white py-3 rounded-xl font-bold hover:bg-orange-600 transition">Submit Application</button>
            </form>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyC4kR_HiywObXho8Zh20JyzC40iVrZq3lo",
            authDomain: "kasifix-5b102.firebaseapp.com",
            projectId: "kasifix-5b102",
            storageBucket: "kasifix-5b102.firebasestorage.app",
            messagingSenderId: "800882399249",
            appId: "1:800882399249:web:f8ecdfb12fa98d7a5779b0"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allHustlers = [];
        let categories = new Set();

        // Load verified hustlers + collect categories
        db.ref('hustlers').on('value', (snapshot) => {
            allHustlers = [];
            const data = snapshot.val();
            if (data) {
                Object.keys(data).forEach(key => {
                    const h = data[key];
                    if (h.verified === true) {
                        allHustlers.push({ id: key, ...h });
                        if (h.category) categories.add(h.category.trim());
                    }
                });
            }
            populateCategoryFilter();
            renderCategories();
            renderFeaturedHustlers();
            filterFeatured(); // initial render for all hustlers
        });

        function populateCategoryFilter() {
            const select = document.getElementById('search-category');
            // Clear existing options except first
            while (select.options.length > 1) select.remove(1);

            [...categories].sort().forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                select.appendChild(opt);
            });
        }

        function renderCategories() {
            const grid = document.getElementById('categories-grid');
            grid.innerHTML = '';
            [...categories].sort().forEach(cat => {
                const card = `
                    <div class="bg-white p-6 rounded-xl shadow-md cursor-pointer card-hover" onclick="filterCategory('${cat}')">
                        <i class="fa-solid fa-tools text-4xl text-[#f97316] mb-4"></i>
                        <h3 class="font-bold text-lg">${cat}</h3>
                    </div>`;
                grid.innerHTML += card;
            });
        }

        function renderFeaturedHustlers() {
            const featured = allHustlers.filter(h => h.featured === true);
            const grid = document.getElementById('featured-grid');
            grid.innerHTML = '';
            if (featured.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-600">
                    <i class="fa-solid fa-star text-6xl mb-6 text-gray-300"></i>
                    <p class="text-xl">No featured hustlers yet.</p>
                </div>`;
                return;
            }
            featured.forEach(h => {
                const card = `
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            ${h.imageUrl ? 
                                `<img src="${h.imageUrl}" alt="${h.name}" class="w-16 h-16 rounded-full object-cover mr-4">` :
                                `<div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold text-gray-600 mr-4">${h.name?.charAt(0) || '?'}</div>`
                            }
                            <div>
                                <h3 class="font-bold text-lg">${h.name || 'Unnamed'}</h3>
                                <p class="text-[#f97316] font-medium">${h.category || '—'}</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4 line-clamp-3">${h.bio || 'No bio available'}</p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-xl">R${h.rate || '—'}/hr</span>
                            <a href="https://wa.me/${h.phone?.replace(/\D/g,'')}" target="_blank" 
                               class="bg-green-600 text-white px-5 py-2 rounded-full text-sm font-medium hover:bg-green-700 transition">
                                <i class="fab fa-whatsapp mr-1"></i> Chat
                            </a>
                        </div>
                    </div>
                </div>`;
                grid.innerHTML += card;
            });
        }

        function toggleAdvanced() {
            const panel = document.getElementById('advanced-panel');
            panel.classList.toggle('open');
        }

        // Live filtering for all hustlers
        function filterFeatured() {
            const keyword   = document.getElementById('search-keyword').value.toLowerCase().trim();
            const location  = document.getElementById('search-location').value.toLowerCase().trim();
            const category  = document.getElementById('search-category').value.trim();
            const minRate   = parseInt(document.getElementById('search-min-rate').value) || 0;
            const verifiedOnly = document.getElementById('search-verified-only').checked;

            const filtered = allHustlers.filter(h => {
                const nameMatch     = (h.name || '').toLowerCase().includes(keyword);
                const catMatch      = (h.category || '').toLowerCase().includes(keyword);
                const bioMatch      = (h.bio || '').toLowerCase().includes(keyword);
                const locMatch      = !location || (h.location || '').toLowerCase().includes(location);

                const categoryMatch = !category || (h.category || '').trim() === category;
                const rateMatch     = !minRate || (parseInt(h.rate) || 0) >= minRate;
                const verifiedMatch = !verifiedOnly || h.verified === true;

                return (nameMatch || catMatch || bioMatch) && locMatch && categoryMatch && rateMatch && verifiedMatch;
            });

            renderHustlers(filtered);
        }

        function renderHustlers(hustlers) {
            const grid = document.getElementById('hustlers-grid');

            if (hustlers.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20 text-gray-600">
                        <i class="fa-solid fa-search text-6xl mb-6 text-gray-300"></i>
                        <p class="text-xl">No matching hustlers found.<br/>Try adjusting your filters.</p>
                    </div>`;
                return;
            }

            grid.innerHTML = '';
            hustlers.slice(0, 9).forEach(h => {
                const card = `
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            ${h.imageUrl ? 
                                `<img src="${h.imageUrl}" alt="${h.name}" class="w-16 h-16 rounded-full object-cover mr-4">` :
                                `<div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold text-gray-600 mr-4">${h.name?.charAt(0) || '?'}</div>`
                            }
                            <div>
                                <h3 class="font-bold text-lg">${h.name || 'Unnamed'}</h3>
                                <p class="text-[#f97316] font-medium">${h.category || '—'}</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4 line-clamp-3">${h.bio || 'No bio available'}</p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-xl">R${h.rate || '—'}/hr</span>
                            <a href="https://wa.me/${h.phone?.replace(/\D/g,'')}" target="_blank" 
                               class="bg-green-600 text-white px-5 py-2 rounded-full text-sm font-medium hover:bg-green-700 transition">
                                <i class="fab fa-whatsapp mr-1"></i> Chat
                            </a>
                        </div>
                    </div>
                </div>`;
                grid.innerHTML += card;
            });
        }

        // Category cards auto-fill keyword
        function filterCategory(cat) {
            document.getElementById('search-keyword').value = cat;
            document.getElementById('search-category').value = cat;
            filterFeatured();
            document.getElementById('featured').scrollIntoView({ behavior: 'smooth' });
        }

        // Modal Functions
        function openFeaturedModal() {
            const modal = document.getElementById('featured-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100');
                modal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('featured-modal');
            modal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
            modal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // Featured Form Submit
        document.getElementById('featured-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                reason: formData.get('reason'),
                timestamp: Date.now()
            };
            db.ref('featured_requests').push(data).then(() => {
                alert('Application submitted successfully!');
                closeModal();
                e.target.reset();
            }).catch(error => {
                alert('Error submitting application: ' + error.message);
            });
        });
    </script>
</body>
</html>
